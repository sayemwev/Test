<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KHELR KHATA - Calculator</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

    <!-- Firebase SDKs (Compat Version for Easy Integration) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        
        body {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #333;
        }

        /* Login Card */
        .login-card {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
            text-align: center;
            width: 380px;
        }

        .google-btn {
            background: #fff;
            color: #444;
            border: 1px solid #ddd;
            padding: 12px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            transition: 0.3s;
            margin-top: 20px;
        }

        .google-btn:hover { background: #f5f5f5; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }

        /* Main Container */
        .app-container {
            display: none;
            width: 95%;
            max-width: 900px;
            grid-template-columns: 1.2fr 1fr;
            gap: 20px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            padding: 25px;
            border-radius: 25px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        @media (max-width: 768px) {
            .app-container { grid-template-columns: 1fr; }
        }

        /* Calculator UI */
        .calculator {
            background: #111;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        #display {
            width: 100%;
            height: 70px;
            background: transparent;
            border: none;
            color: #00ff88;
            font-size: 35px;
            text-align: right;
            margin-bottom: 20px;
            outline: none;
            border-bottom: 1px solid #333;
        }

        .buttons { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
        
        button {
            height: 60px;
            border-radius: 12px;
            border: none;
            font-size: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
        }

        .num { background: #222; color: white; }
        .num:hover { background: #333; }
        .op { background: #3498db; color: white; }
        .op:hover { background: #2980b9; }
        .equal { background: #27ae60; color: white; grid-column: span 2; }
        .clear { background: #e74c3c; color: white; grid-column: span 2; }

        /* History */
        .history-box {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 20px;
            height: 450px;
            display: flex;
            flex-direction: column;
        }

        .history-list {
            flex-grow: 1;
            overflow-y: auto;
            margin-top: 10px;
        }

        .history-item {
            padding: 8px;
            border-bottom: 1px solid #ddd;
            font-size: 15px;
            color: #333;
        }

        .user-bar {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logout-btn { background: #ff4757; color: white; border: none; padding: 5px 12px; border-radius: 5px; cursor: pointer; }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <!-- User Bar (Log out) -->
    <div id="user-bar" class="user-bar hidden">
        <span id="user-name"></span>
        <button class="logout-btn" onclick="logout()">লগআউট</button>
    </div>

    <!-- Login Page -->
    <div id="login-page" class="login-card">
        <h1 style="color: #2a5298;">KHELR KHATA</h1>
        <p style="color: #666;">ক্যালকুলেটর ডাটা সেভ রাখতে লগইন করুন</p>
        <button class="google-btn" onclick="googleLogin()">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/02/20/google_signin_buttons/google-icon.svg" width="20">
            Google দিয়ে লগইন করুন
        </button>
    </div>

    <!-- App Content -->
    <div id="app-content" class="app-container">
        <!-- Calculator -->
        <div class="calculator">
            <input type="text" id="display" readonly placeholder="0">
            <div class="buttons">
                <button class="clear" onclick="clearDisplay()">AC</button>
                <button class="op" onclick="append('/')">÷</button>
                <button class="op" onclick="append('*')">×</button>
                
                <button class="num" onclick="append('7')">7</button>
                <button class="num" onclick="append('8')">8</button>
                <button class="num" onclick="append('9')">9</button>
                <button class="op" onclick="append('-')">−</button>
                
                <button class="num" onclick="append('4')">4</button>
                <button class="num" onclick="append('5')">5</button>
                <button class="num" onclick="append('6')">6</button>
                <button class="op" onclick="append('+')">+</button>
                
                <button class="num" onclick="append('1')">1</button>
                <button class="num" onclick="append('2')">2</button>
                <button class="num" onclick="append('3')">3</button>
                <button class="num" onclick="append('0')">0</button>
                
                <button class="num" onclick="append('.')">.</button>
                <button class="equal" onclick="calculate()">=</button>
            </div>
        </div>

        <!-- History -->
        <div class="history-box">
            <h3 style="color: #1e3c72; border-bottom: 2px solid #3498db;">হিসাবের ইতিহাস</h3>
            <div id="history-list" class="history-list">
                <p style="color: #999; text-align: center; margin-top: 20px;">কোনো ইতিহাস নেই</p>
            </div>
        </div>
    </div>

    <script>
        // --- আপনার দেওয়া কনফিগারেশন এখানে সেট করা হয়েছে ---
        const firebaseConfig = {
            apiKey: "AIzaSyBfOccPUd746fyIX5443u_KljfQfT3HnRU",
            authDomain: "khelar-khata.firebaseapp.com",
            databaseURL: "https://khelar-khata-default-rtdb.firebaseio.com",
            projectId: "khelar-khata",
            storageBucket: "khelar-khata.firebasestorage.app",
            messagingSenderId: "1049420069640",
            appId: "1:1049420069640:web:8aec777f628916ee278abd",
            measurementId: "G-HB1281RCCV"
        };

        // Firebase ইনিশিয়ালাইজেশন
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const provider = new firebase.auth.GoogleAuthProvider();

        // UI কন্ট্রোল
        const loginPage = document.getElementById('login-page');
        const appContent = document.getElementById('app-content');
        const userBar = document.getElementById('user-bar');
        const userNameDisp = document.getElementById('user-name');
        const display = document.getElementById('display');
        const historyList = document.getElementById('history-list');

        // লগইন ফাংশন
        function googleLogin() {
            auth.signInWithPopup(provider).catch(err => alert("Error: " + err.message));
        }

        // লগআউট ফাংশন
        function logout() {
            auth.signOut();
        }

        // অথেনটিকেশন চেক
        auth.onAuthStateChanged(user => {
            if (user) {
                loginPage.classList.add('hidden');
                appContent.style.display = 'grid';
                userBar.classList.remove('hidden');
                userNameDisp.innerText = user.displayName;
                loadHistory(user.uid);
            } else {
                loginPage.classList.remove('hidden');
                appContent.style.display = 'none';
                userBar.classList.add('hidden');
            }
        });

        // ক্যালকুলেটর লজিক
        function append(val) { display.value += val; }
        function clearDisplay() { display.value = ""; }

        function calculate() {
            try {
                const result = eval(display.value);
                if (result === undefined) return;
                const record = `${display.value} = ${result}`;
                display.value = result;
                saveToFirebase(record);
            } catch (e) {
                display.value = "Error";
                setTimeout(clearDisplay, 1000);
            }
        }

        // ডাটাবেজ লজিক
        function saveToFirebase(str) {
            const user = auth.currentUser;
            if (user) {
                db.collection("history").add({
                    userId: user.uid,
                    calculation: str,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
            }
        }

        function loadHistory(uid) {
            db.collection("history")
                .where("userId", "==", uid)
                .orderBy("createdAt", "desc")
                .limit(20)
                .onSnapshot(snap => {
                    historyList.innerHTML = "";
                    if (snap.empty) {
                        historyList.innerHTML = '<p style="color: #999; text-align: center; margin-top: 20px;">কোনো ইতিহাস নেই</p>';
                    }
                    snap.forEach(doc => {
                        const div = document.createElement('div');
                        div.className = "history-item";
                        div.innerText = doc.data().calculation;
                        historyList.appendChild(div);
                    });
                });
        }
    </script>
</body>
</html>